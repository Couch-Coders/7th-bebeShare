name: deploy

on: 
	push:
		branches: [ main, develop ]
	pull_request:
		branches: 
      - main
			- develop

jobs:
	run-on: ubuntu-lastest 
	steps: 
		- name: checkout  
			uses: actions/checkout@v2

		- name: java11 setup
			uses: actions/setup-java@v2
		  with:
		    distribution: 'temurin'
		    java-version: '11'

      - name: build gradle
        run: ./gradlew build --exclude-task test
        shell: bash
    
    - name: deploy to heroku
     uses: akhileshns/heroku-deploy@v3.12.12
     with:
       heroku_api_key: ${{secrets.HEROKU_API_KEY}}
       heroku_app_name: "bebeshare" #Must be unique in Heroku
       heroku_email: "ltwy0311@naver.com"
		
		- name: slack-notification
      uses: Ilshidur/action-slack@master
      with:
        args: '${{ github.ref }} unittest, ${{ job.status }}
        https://{{github주소}}/actions/runs/{{ GITHUB_RUN_ID }}'
      env:
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
      if: failure()
